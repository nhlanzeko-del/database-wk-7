-- Create the original table (if it doesn't exist)
CREATE TABLE IF NOT EXISTS OrderDetails (
    OrderID INT,
    CustomerName VARCHAR(100),
    Product VARCHAR(100),
    Quantity INT,
    PRIMARY KEY (OrderID, Product)
);

-- Insert sample data
INSERT INTO OrderDetails VALUES 
(101, 'John Doe', 'Laptop', 2),
(101, 'John Doe', 'Mouse', 1),
(102, 'Jane Smith', 'Tablet', 3),
(102, 'Jane Smith', 'Keyboard', 1),
(102, 'Jane Smith', 'Mouse', 2),
(103, 'Emily Clark', 'Phone', 1);

-- Transform to 2NF by removing partial dependencies
-- Step 1: Create Orders table (removes CustomerName dependency on OrderID)
CREATE TABLE Orders AS
SELECT DISTINCT OrderID, CustomerName
FROM OrderDetails;

ALTER TABLE Orders ADD PRIMARY KEY (OrderID);

-- Step 2: Create OrderItems table (maintains Product and Quantity dependencies)
CREATE TABLE OrderItems AS
SELECT OrderID, Product, Quantity
FROM OrderDetails;

ALTER TABLE OrderItems ADD PRIMARY KEY (OrderID, Product);
ALTER TABLE OrderItems ADD FOREIGN KEY (OrderID) REFERENCES Orders(OrderID);

-- Verify the 2NF structure
/*
Orders table:
OrderID (PK) | CustomerName
---------------------------
101          | John Doe
102          | Jane Smith
103          | Emily Clark

OrderItems table:
OrderID (FK) | Product   | Quantity
-----------------------------------
101          | Laptop    | 2
101          | Mouse     | 1
102          | Tablet    | 3
102          | Keyboard  | 1
102          | Mouse     | 2
103          | Phone     | 1
*/
